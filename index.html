<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¸ëœë“œì²´ì´ìŠ¤ ìŠ¤ì¼€ì¥´ëŸ¬</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2401@1.0/LINESeedKR-Bd.woff2">
    <style>
        @font-face {
            font-family: 'LINESeedKR-Bd';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2401@1.0/LINESeedKR-Bd.woff2') format('woff2');
            font-weight: 700; font-style: normal;
        }

        :root {
            --bg-main: #f0f4f7; --bg-container: #ffffff; --bg-item: #eef2f5; --text-color: #444a53;
            --accent-color: #ff5e5e; --shadow-color: rgba(0, 0, 0, 0.08);
            --border-color: #dee2e6; --shared-tag: #868e96;
            --progress-bar-bg: #e9ecef;
            --progress-daily: #51cf66; --progress-weekly: #339af0;
            --void-1: #e599f7; --void-2: #be4bdb; --void-3: #862e9c;
        }
        .dark-mode {
            --bg-main: #1a1b1e; --bg-container: #25262b; --bg-item: #2c2e33; --text-color: #ced4da;
            --accent-color: #ff6b6b; --shadow-color: rgba(0, 0, 0, 0.3);
            --border-color: #373a40; --shared-tag: #909296; --progress-bar-bg: #373a40;
        }

        body { background-color: var(--bg-main); color: var(--text-color); font-family: 'LINESeedKR-Bd', sans-serif; display: flex; justify-content: center; padding: 20px; margin: 0; transition: all 0.3s; box-sizing: border-box; }
        .container { width: 100%; max-width: 1250px; background-color: var(--bg-container); padding: 30px; border-radius: 25px; box-shadow: 0 15px 40px var(--shadow-color); position: relative; box-sizing: border-box; }
        
        #character-selector { display: grid; grid-template-columns: repeat(12, 1fr); gap: 10px; margin-bottom: 20px; padding: 10px; border-radius: 20px; transition: 0.2s; border: 2px solid transparent; }
        #character-selector.drag-over { border-color: var(--accent-color); background: rgba(255, 94, 94, 0.05); }

        .char-btn { width: 100%; border-radius: 18px; background-color: var(--bg-item); border: 2px solid transparent; padding: 12px 0; cursor: pointer; transition: 0.25s; display: flex; flex-direction: column; align-items: center; }
        .char-btn.active { border-color: var(--char-color, var(--accent-color)); background-color: var(--bg-container); transform: translateY(-5px); box-shadow: 0 8px 15px var(--shadow-color); }
        
        /* ì¦ê²¨ì°¾ê¸° ì‹œ ë…¸ë€ìƒ‰ ëŒ€ì‹  ê³ ìœ  ìƒ‰ìƒ í…Œë‘ë¦¬ ì ìš© */
        .char-btn.is-fav { border: 2.5px solid var(--char-color, #ffd43b); }

        .multi-gauge { width: 80%; margin-top: 8px; display: flex; flex-direction: column; gap: 3px; }
        .gauge-layer { height: 5px; background: var(--progress-bar-bg); border-radius: 10px; overflow: hidden; display: flex; }
        .void-cell { flex: 1; height: 100%; opacity: 0.15; }
        .void-cell.done-1 { opacity: 1; background: var(--void-1); }
        .void-cell.done-2 { opacity: 1; background: var(--void-2); }
        .void-cell.done-3 { opacity: 1; background: var(--void-3); }

        .main-layout { display: flex; gap: 20px; margin-bottom: 25px; align-items: flex-start; }
        #favorite-sidebar { width: 260px; background: var(--bg-item); padding: 20px; border-radius: 25px; min-height: 480px; border: 2px dashed var(--border-color); transition: 0.2s; }
        #favorite-sidebar.drag-over { border-color: #ffd43b; background: rgba(255, 212, 59, 0.1); }
        
        #favorite-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        #task-view-container { flex: 1; display: flex; gap: 20px; }
        
        .column { flex: 1; background: var(--bg-item); padding: 20px; border-radius: 25px; min-height: 480px; }
        .column h3 { margin-top: 0; text-align: center; margin-bottom: 20px; }
        
        .task-item { 
            display: flex; align-items: center; padding: 15px; background: var(--bg-container); margin-bottom: 12px; 
            border-radius: 20px; cursor: pointer; position: relative; transition: 0.2s; 
            justify-content: space-between;
        }
        .task-item.done { opacity: 0.45; }
        .task-content { display: flex; align-items: center; gap: 12px; }

        .all-check-wrapper { display: flex; flex-direction: column; align-items: center; margin-left: auto; z-index: 10; cursor: pointer; }
        .badge { display: inline-flex; width: 26px; height: 26px; border-radius: 50%; color: #fff; font-size: 11px; align-items: center; justify-content: center; font-weight: bold; border: none; pointer-events: none; }

        .calendar-section { width: 100%; display: flex; gap: 20px; margin-top: 20px; box-sizing: border-box; align-items: stretch; }
        .weekly-report { width: 180px; background: var(--bg-item); padding: 20px; border-radius: 25px; display: flex; flex-direction: column; }
        .calendar-main { flex: 1; background: var(--bg-item); padding: 20px; border-radius: 25px; display: flex; flex-direction: column; }
        
        .day-header { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; text-align: center; font-size: 0.8em; font-weight: bold; margin-bottom: 15px; opacity: 0.7; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; flex: 1; }

        .fill-cell { 
            position: relative; background: var(--progress-bar-bg); border-radius: 12px; overflow: hidden; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid rgba(0,0,0,0.03);
            min-height: 85px; 
        }
        .fill-bar { position: absolute; bottom: 0; left: 0; width: 100%; transition: height 0.5s ease; z-index: 1; }
        .fill-text { position: relative; z-index: 2; font-weight: bold; font-size: 0.85em; }
        .fill-label { position: relative; z-index: 2; font-size: 0.7em; opacity: 0.8; }

        .top-btn { border: none; padding: 8px 15px; border-radius: 50px; cursor: pointer; font-family: inherit; font-weight: bold; background: var(--bg-item); color: var(--text-color); transition: 0.2s; }
        .top-btn:hover { filter: brightness(0.9); }
        .top-btn.active-filter { background: var(--accent-color); color: white; }

        .footer { margin-top: 30px; display: flex; justify-content: space-between; font-size: 0.9em; }
        .credit { color: #00bfff; font-weight: bold; } 
    </style>
</head>
<body class="dark-mode">

<div class="container">
    <div style="position: absolute; top: 25px; right: 25px; display: flex; gap: 10px;">
        <button id="filter-btn" class="top-btn" onclick="toggleFilter()">ğŸ” ìˆ™ì œ ë‚¨ì€ ìºë¦­í„°ë§Œ ë³´ê¸°</button>
        <button id="theme-btn" class="top-btn" onclick="toggleTheme()">í…Œë§ˆ ë³€ê²½</button>
    </div>

    <h1 style="text-align: center;">ê·¸ëœë“œì²´ì´ìŠ¤ ìŠ¤ì¼€ì¥´ëŸ¬</h1>
    
    <div style="display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 0.9em; opacity: 0.8;">
        <div>ì´ˆê¸°í™” : ì¼ì¼ 15:00 | ì£¼ê°„: ìˆ˜ìš”ì¼ 15:00 (KST)</div>
        <div id="current-time-display"></div>
    </div>

    <div id="character-selector" ondragover="allowDrop(event)" ondragleave="dragLeave(this)" ondrop="dropToUnfav(event)"></div>

    <div class="main-layout">
        <div id="favorite-sidebar" ondragover="allowDrop(event)" ondragleave="dragLeave(this)" ondrop="dropToFavorite(event)">
            <h3 style="text-align: center; margin-top: 0;">â­ ì¦ê²¨ì°¾ê¸°</h3>
            <div id="favorite-list"></div>
        </div>
        <div id="task-view-container">
            <div class="column"><h3>ğŸ“… ì¼ì¼ ìˆ™ì œ</h3><div id="daily-list"></div></div>
            <div class="column"><h3>âš”ï¸ ì£¼ê°„ ìˆ™ì œ</h3><div id="weekly-list"></div></div>
        </div>
    </div>

    <div class="calendar-section">
        <div class="weekly-report">
            <h4 style="margin:0 0 15px 0; text-align:center;">ğŸ“Š ì£¼ê°„ ë‹¬ì„±ë¥ </h4>
            <div id="week-gauges" style="display:flex; flex-direction:column; gap:10px; flex:1; justify-content:space-between;"></div>
        </div>
        <div class="calendar-main">
            <div class="day-header">
                <div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div><div>ì¼</div>
            </div>
            <div id="calendar-grid" class="calendar-grid"></div>
        </div>
    </div>

    <div class="footer">
        <div>â€¢ ì¦ê²¨ì°¾ê¸° ëœ ìºë¦­í„°ë§Œ ë‹¬ë ¥ í†µê³„ì— ë°˜ì˜ë©ë‹ˆë‹¤.<br>â€¢ Alt + í´ë¦­: ì¦ê²¨ì°¾ê¸° ì¶”ê°€/í•´ì œ</div>
        <div class="credit">Made by ê¹¡</div>
    </div>
</div>

<script>
    const CHAR_COLORS = {
        'ì—˜ë¦¬ì‹œìŠ¤': '#e03131', 'ë¦¬ë¥´': '#66a80f', 'ì•„ë¥´ë©”': '#9c36b5', 
        'ë¼ìŠ¤': '#339af0', 'ë¼ì´ì–¸': '#2f9e44', 'ë¡œë‚œ': '#1971c2', 'ì—ì´ë¯¸': '#f06595', 'ì§„': '#f08c00',
        'ì§€í¬í•˜íŠ¸': '#495057', 'ë§ˆë¦¬': '#339af0', 'ë””ì˜¤': '#5f3dc4', 'ì œë¡œ': '#0ca678', 
        'ë ˆì´': '#e599f7', 'ë£¨í¼ìŠ¤': '#c92a2a', 'ë¦°': '#1864ab', 'ì•„ì‹ ': '#1098ad', 
        'ë¼ì„': '#94d82d', 'ì—ë¸': '#4dabf7', 'ë² ì´ê°€ìŠ¤': '#7048e8', 'ë°ì¹´ë„¤': '#4b0082', 
        'ì•„ì´': '#74c0fc', 'ì¹¼ë¦¬ì•„': '#ff6b6b', 'ìš°ë…¸': '#087f5b', 'ì´ë¦¬ìŠ¤': '#d3f9d8'
    };

    const CHARS = Object.keys(CHAR_COLORS);
    const DATA = {
        void: [{id:'v1', name:'ê³µí—ˆ ì¹¨ê³µ', day:'ì›”'}, {id:'v2', name:'ê³µí—ˆ ì ì‹', day:'ìˆ˜'}, {id:'v3', name:'ê³µí—ˆ ì•…ëª½', day:'ê¸ˆ'}],
        daily: [{id:'d1', name:'ë² ë¥´ì¹´ìŠ¤ì˜ ìš”ìƒˆ'}, {id:'d2', name:'ì†Œë©¸ì˜ íƒ‘'}, {id:'d3', name:'í…Œë¡œì¹´ ê³µì„±ì „'}, {id:'d4', name:'ì‹œê°„ì˜ ì‚¬ì›'}, {id:'d5', name:'ì½”ìš°ë‚˜íŠ¸ ëŒ€í­ë°œ'}, {id:'d6', name:'ë¬´í•œíšŒë‘', shared:true, day:'ê³µ'}],
        weekly: [{id:'w2', name:'ì‹¬ì—°ì˜ ê¸¸'}, {id:'w5', name:'í™˜ì˜ì˜ ë¯¸ê¶'}, {id:'w4', name:'íŒŒë©¸ì˜ ì„±ì†Œ'}, {id:'w3', name:'ì§€ì˜¥ì˜ ìš©ê´‘ë¡œ'}, {id:'w1', name:'ì‹¬íŒì˜ ë•…'}]
    };

    let charList = [];
    let currentId = 1;
    let draggedCharId = null;
    let filterUnfinished = false;

    function init() {
        const saved = localStorage.getItem('gcc_v26_data');
        if (saved) charList = JSON.parse(saved);
        else charList = CHARS.map((name, i) => ({ id: i + 1, name, daily: {}, weekly: {}, void: {}, fav: false }));
        render();
        setInterval(() => { document.getElementById('current-time-display').innerText = new Date().toLocaleString('ko-KR'); }, 1000);
    }

    function isCharFinished(char) {
        const dDone = DATA.daily.every(t => t.shared ? charList[0].daily[t.id] : char.daily[t.id]);
        const wDone = DATA.weekly.every(t => char.weekly[t.id]);
        const vDone = DATA.void.every(t => char.void[t.id]);
        return dDone && wDone && vDone;
    }

    function render() {
        const selector = document.getElementById('character-selector');
        const favList = document.getElementById('favorite-list');
        selector.innerHTML = ''; favList.innerHTML = '';

        charList.forEach(char => {
            const finished = isCharFinished(char);
            if (filterUnfinished && char.fav && finished && char.id !== currentId) return;

            const btn = createCharBtn(char);
            btn.onclick = (e) => { 
                if(e.altKey) { char.fav = !char.fav; render(); } 
                else { currentId = char.id; render(); } 
            };
            btn.ondragstart = () => { draggedCharId = char.id; };
            selector.appendChild(btn);

            if (char.fav) {
                const fBtn = btn.cloneNode(true);
                fBtn.onclick = btn.onclick;
                fBtn.ondragstart = btn.ondragstart;
                favList.appendChild(fBtn);
            }
        });

        const activeChar = charList.find(c => c.id === currentId);
        document.querySelectorAll('.char-btn').forEach(b => { 
            const bid = parseInt(b.dataset.id);
            const targetChar = charList.find(c => c.id === bid);
            b.style.setProperty('--char-color', CHAR_COLORS[targetChar.name]); // ëª¨ë“  ë²„íŠ¼ì— ê³ ìœ ìƒ‰ ë³€ìˆ˜ í• ë‹¹
            
            if(bid === currentId) {
                b.classList.add('active');
            } else {
                b.classList.remove('active');
            }
        });
        
        renderTasks();
        saveHistory();
        renderStats();
        localStorage.setItem('gcc_v26_data', JSON.stringify(charList));
    }

    function createCharBtn(char) {
        const btn = document.createElement('div');
        btn.className = `char-btn ${char.fav ? 'is-fav' : ''}`;
        btn.dataset.id = char.id; btn.draggable = true;
        const dDone = DATA.daily.filter(t => t.shared ? charList[0].daily[t.id] : char.daily[t.id]).length;
        const wDone = DATA.weekly.filter(t => char.weekly[t.id]).length;
        btn.innerHTML = `
            <div style="font-weight:bold; font-size:0.85em;">${char.name}</div>
            <div class="multi-gauge">
                <div class="gauge-layer"><div style="width:${(dDone/DATA.daily.length)*100}%; background:var(--progress-daily); height:100%"></div></div>
                <div class="gauge-layer"><div style="width:${(wDone/DATA.weekly.length)*100}%; background:var(--progress-weekly); height:100%"></div></div>
                <div class="gauge-layer">
                    <div class="void-cell ${char.void['v1']?'done-1':''}"></div>
                    <div class="void-cell ${char.void['v2']?'done-2':''}"></div>
                    <div class="void-cell ${char.void['v3']?'done-3':''}"></div>
                </div>
            </div>`;
        return btn;
    }

    function renderTasks() {
        const cur = charList.find(c => c.id === currentId);
        const charColor = CHAR_COLORS[cur.name];
        const dList = document.getElementById('daily-list'); const wList = document.getElementById('weekly-list');
        dList.innerHTML = ''; wList.innerHTML = '';
        
        DATA.void.forEach((t, i) => {
            const voidColors = ['#e599f7', '#be4bdb', '#862e9c'];
            wList.appendChild(createTaskUI(t.name, cur.void[t.id], t.day, () => { cur.void[t.id] = !cur.void[t.id]; render(); }, voidColors[i], t.id, 'void', charColor));
        });
        DATA.daily.forEach(t => {
            const done = t.shared ? charList[0].daily[t.id] : cur.daily[t.id];
            dList.appendChild(createTaskUI(t.name, done, t.day, () => {
                if (t.shared) { const n = !done; charList.forEach(c => c.daily[t.id] = n); } else cur.daily[t.id] = !done; render();
            }, charColor, t.id, 'daily', charColor));
        });
        DATA.weekly.forEach(t => wList.appendChild(createTaskUI(t.name, cur.weekly[t.id], null, () => { cur.weekly[t.id] = !cur.weekly[t.id]; render(); }, charColor, t.id, 'weekly', charColor)));
    }

    function createTaskUI(name, done, day, onClick, badgeColor, taskId, type, charColor) {
        const div = document.createElement('div'); div.className = `task-item ${done ? 'done' : ''}`;
        const content = document.createElement('div'); content.className = 'task-content';
        let badge = day ? `<span class="badge" style="background:${badgeColor}">${day}</span>` : '';
        content.innerHTML = `${badge}<span>${name}</span>`;
        
        const all = document.createElement('div'); all.className = 'all-check-wrapper';
        all.innerHTML = `<span style="font-size:9px; font-weight:bold; color:var(--shared-tag)">ALL</span><button class="badge" style="background:${done ? charColor : 'var(--shared-tag)'}">${done?'âœ“':'A'}</button>`;
        all.onclick = (e) => { e.stopPropagation(); const n = !done; charList.forEach(c => { if(c.fav) c[type][taskId] = n; }); render(); };
        
        div.appendChild(content); div.appendChild(all); 
        div.onclick = onClick; return div;
    }

    function saveHistory() {
        const today = new Date().toISOString().split('T')[0];
        const history = JSON.parse(localStorage.getItem('gcc_hist_v26') || '{}');
        const favs = charList.filter(c => c.fav);
        if (favs.length > 0) {
            let t = 0, d = 0;
            favs.forEach(c => { DATA.daily.forEach(task => { t++; if(task.shared ? charList[0].daily[task.id] : c.daily[task.id]) d++; }); });
            history[today] = Math.round((d / t) * 100);
        }
        localStorage.setItem('gcc_hist_v26', JSON.stringify(history));

        const weeklyHistory = JSON.parse(localStorage.getItem('gcc_week_v26') || '{}');
        const now = new Date();
        const yearWeek = `${now.getFullYear()}-W${getWeekNumber(now)}`;
        let wt = 0, wd = 0;
        favs.forEach(c => { 
            DATA.weekly.forEach(task => { wt++; if(c.weekly[task.id]) wd++; });
            DATA.void.forEach(task => { wt++; if(c.void[task.id]) wd++; });
        });
        weeklyHistory[yearWeek] = favs.length ? Math.round((wd / wt) * 100) : 0;
        localStorage.setItem('gcc_week_v26', JSON.stringify(weeklyHistory));
    }

    function getWeekNumber(d) {
        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
        var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    function renderStats() {
        const grid = document.getElementById('calendar-grid'); grid.innerHTML = '';
        const weekGauges = document.getElementById('week-gauges'); weekGauges.innerHTML = '';
        const now = new Date(); const year = now.getFullYear(); const month = now.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const lastDay = new Date(year, month + 1, 0).getDate();
        const startOffset = (firstDay === 0 ? 6 : firstDay - 1);
        for(let i=0; i<startOffset; i++) grid.appendChild(document.createElement('div'));
        const history = JSON.parse(localStorage.getItem('gcc_hist_v26') || '{}');
        for (let i = 1; i <= lastDay; i++) {
            const dateStr = `${year}-${String(month + 1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
            grid.appendChild(createFillCell(i, history[dateStr] || 0, '#2b8a3e'));
        }
        const weeklyHistory = JSON.parse(localStorage.getItem('gcc_week_v26') || '{}');
        for(let w=1; w<=5; w++) {
            const weekKey = `${year}-W${getWeekNumber(new Date(year, month, Math.min(lastDay, (w-1)*7 + 1)))}`;
            weekGauges.appendChild(createFillCell(w + 'ì£¼ì°¨', weeklyHistory[weekKey] || 0, '#339af0'));
        }
    }

    function createFillCell(label, percent, color) {
        const div = document.createElement('div'); div.className = 'fill-cell';
        const bar = document.createElement('div'); bar.className = 'fill-bar';
        bar.style.height = percent + '%'; bar.style.backgroundColor = color;
        bar.style.opacity = percent === 0 ? '0' : (0.2 + (percent/100)*0.8);
        div.innerHTML = `<span class="fill-label">${label}</span><span class="fill-text">${percent}%</span>`;
        div.appendChild(bar); return div;
    }

    function toggleTheme() { document.body.classList.toggle('dark-mode'); }
    function toggleFilter() { 
        filterUnfinished = !filterUnfinished; 
        document.getElementById('filter-btn').classList.toggle('active-filter');
        render(); 
    }
    
    function allowDrop(e) { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
    function dragLeave(el) { el.classList.remove('drag-over'); }
    function dropToFavorite(e) { e.preventDefault(); dragLeave(e.currentTarget); const char = charList.find(c => c.id === draggedCharId); if (char) { char.fav = true; render(); } }
    function dropToUnfav(e) { e.preventDefault(); dragLeave(e.currentTarget); const char = charList.find(c => c.id === draggedCharId); if (char) { char.fav = false; render(); } }

    init();
</script>
</body>
</html>
