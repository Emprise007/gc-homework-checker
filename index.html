<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¸ëœë“œì²´ì´ìŠ¤ ìˆ™ì œí‘œ</title>
    <style>
        /* === 1. ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ë³€ìˆ˜ ì„¤ì • (ë¬´ì±„ìƒ‰ ê³„ì—´) === */
        :root {
            /* Light Mode Default (Monochromatic) */
            --bg-main: #f0f0f0;
            --bg-container: #ffffff;
            --bg-item: #e8e8e8;
            --text-color: #333333;
            --accent-color: #cc0000; /* Red for important elements */
            --shadow-color: rgba(0, 0, 0, 0.15);
            --border-color: #ccc;
            --shared-tag: #666666; /* Neutral Grey Tag */
            --drag-bg: #ffcccc;
        }

        /* Dark Mode (Class ì ìš© ì‹œ) (Monochromatic) */
        .dark-mode {
            --bg-main: #1c1c1c;
            --bg-container: #252525;
            --bg-item: #333333;
            --text-color: #f0f0f0;
            --accent-color: #ff3333; /* Bright Red for important elements */
            --shadow-color: rgba(255, 255, 255, 0.1);
            --border-color: #444;
            --shared-tag: #999999; /* Neutral Grey Tag */
            --drag-bg: #550000;
        }

        /* === 2. ê¸°ë³¸ ìŠ¤íƒ€ì¼ === */
        body { 
            background-color: var(--bg-main); 
            color: var(--text-color); 
            font-family: 'Malgun Gothic', sans-serif; 
            display: flex; 
            justify-content: center; 
            padding: 20px; 
            margin: 0; 
            transition: background-color 0.3s, color 0.3s;
        }
        .container { 
            width: 100%; 
            max-width: 1100px; 
            background-color: var(--bg-container); 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px var(--shadow-color); 
        }
        
        /* ì œëª© ë° í—¤ë” */
        h1 { text-align: center; color: var(--accent-color); margin-bottom: 5px; font-size: 2em; }
        p.sub-title { text-align: center; color: var(--text-color); opacity: 0.7; font-size: 0.9em; margin-top: 0; margin-bottom: 25px; }
        h2 { 
            border-bottom: 2px solid var(--border-color); 
            padding-bottom: 8px; 
            margin-top: 35px; 
            font-size: 1.5em; 
            color: var(--text-color); /* H2ëŠ” ì¼ë°˜ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            text-align: center;
        }
        h3 { color: var(--text-color); margin-top: 15px; margin-bottom: 10px; font-size: 1.1em; }
        
        /* === 3. ëª¨ë“œ í† ê¸€ ë²„íŠ¼ === */
        #theme-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            background: var(--bg-item);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        #theme-toggle:hover { background: var(--accent-color); color: white; }

        /* === 4. ìºë¦­í„° ì„ íƒ ë²„íŠ¼ (DND ì ìš©) === */
        #character-selector { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 6px; 
            margin-bottom: 25px; 
        }
        .char-btn { 
            background-color: var(--bg-item); 
            color: var(--text-color); 
            border: 1px solid var(--border-color); 
            padding: 8px 12px; 
            border-radius: 20px; 
            cursor: grab; 
            font-size: 0.85em; 
            transition: all 0.3s;
            user-select: none;
        }
        .char-btn:hover { background-color: var(--accent-color); color: white; }
        .char-btn.active { 
            background-color: var(--accent-color); 
            color: white; 
            font-weight: bold; 
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        .char-btn.dragging {
            opacity: 0.5;
            box-shadow: 0 5px 15px var(--shadow-color);
        }
        .char-btn.drag-over {
            border: 2px dashed var(--accent-color);
            background-color: var(--drag-bg);
        }

        /* === 5. ìˆ™ì œ ëª©ë¡ (ì¢Œìš° ë¶„í• ) === */
        #task-view-container { 
            display: flex; 
            gap: 30px; 
            margin-top: 20px;
        }
        .task-column { 
            flex: 1; 
            background-color: var(--bg-main); 
            padding: 20px; 
            border-radius: 10px;
            box-shadow: inset 0 0 10px var(--shadow-color);
        }

        .task-item { 
            display: flex; 
            align-items: center; 
            background-color: var(--bg-item); 
            margin-bottom: 10px; 
            padding: 12px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s; 
            font-size: 1em;
            justify-content: space-between;
        }
        .task-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px var(--shadow-color); }
        .task-item.done { opacity: 0.6; }
        
        .task-label-group { display: flex; align-items: center; }
        .task-label { font-weight: bold; margin-right: 15px; }
        
        /* íšŸìˆ˜ í‘œì‹œ */
        .count-display {
            font-size: 1em;
            font-weight: bold;
            color: var(--text-color); /* ê¸°ë³¸ ì¹´ìš´íŠ¸ëŠ” ì¼ë°˜ í…ìŠ¤íŠ¸ */
            min-width: 40px;
            text-align: right;
        }
        .count-display.completed { color: var(--accent-color); } /* ì™„ë£Œ ì‹œ ë¹¨ê°„ìƒ‰ */

        .account-shared-tag { 
            font-size: 0.7em; 
            background-color: var(--shared-tag); 
            color: white; 
            padding: 3px 6px; 
            border-radius: 4px; 
            margin-left: 10px;
            font-weight: normal;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            #task-view-container {
                flex-direction: column; 
            }
            .container { padding: 15px; }
            #theme-toggle { top: 15px; right: 15px; padding: 6px 10px; font-size: 0.8em; }
        }
    </style>
</head>
<body class="dark-mode"> <div class="container">
    <button id="theme-toggle" onclick="toggleTheme()"></button>
    <h1>ê·¸ëœë“œì²´ì´ìŠ¤ ìˆ™ì œí‘œ</h1>
    <p class.sub-title>ì¼ì¼: ë§¤ì¼ 15:00 ì´ˆê¸°í™” | ì£¼ê°„: ìˆ˜ìš”ì¼ 15:00 ì´ˆê¸°í™” (KST)</p>

    <h2>ìºë¦­í„° ì„ íƒ (ë“œë˜ê·¸ ì•¤ ë“œë¡­ìœ¼ë¡œ ìˆœì„œ ë³€ê²½ ê°€ëŠ¥)</h2>
    <div id="character-selector"></div>
    
    <h2 id="current-char-name"></h2>

    <div id="task-view-container">
        <div class="task-column">
            <h3>ğŸ“… ì¼ì¼ ìˆ™ì œ (ìºë¦­í„°ë³„ ë° ê³„ì • ê³µìœ  ì¼ì¼)</h3>
            <div id="daily-list"></div>
        </div>

        <div class="task-column">
            <h3>âš”ï¸ ì£¼ê°„ ìˆ™ì œ (ìºë¦­í„°ë³„)</h3>
            <div id="weekly-list"></div>
        </div>
    </div>

    <div class="footer">
        ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤. (ê¸°ê¸° ê°„ ì—°ë™ X)
    </div>
</div>

<script>
    // === 1. ê¸°ë³¸ ë°ì´í„° ì„¤ì • ===

    // 24ê°œ ìºë¦­í„° ë¦¬ìŠ¤íŠ¸ (ìˆœì„œ ë³€ê²½ ì‹œ ì´ ë°°ì—´ì´ ì—…ë°ì´íŠ¸ë¨)
    let CHARACTER_NAMES = [
        'ì—˜ë¦¬ì‹œìŠ¤', 'ë¦¬ë¥´', 'ì•„ë¥´ë©”', 'ë¼ìŠ¤', 'ë¼ì´ì–¸', 'ë¡œë‚œ', 'ì—ì´ë¯¸', 'ì§„', 'ì§€í¬í•˜íŠ¸', 'ë§ˆë¦¬', 
        'ë””ì˜¤', 'ì œë¡œ', 'ë ˆì´', 'ë£¨í¼ìŠ¤', 'ë² ì´ê°€ìŠ¤', 'ë¦°', 'ì•„ì‹ ', 'ë¼ì„', 'ì—ë¸', 'ë°ì¹´ë„¤', 
        'ì•„ì´', 'ì¹¼ë¦¬ì•„', 'ìš°ë…¸', 'ì´ë¦¬ìŠ¤'
    ];
    
    // ë˜ì „ ëª©ë¡: max ì†ì„±ìœ¼ë¡œ ìµœëŒ€ íšŸìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    const DUNGEON_DATA = {
        daily: [
            { id: 'berkas', name: 'ë² ë¥´ì¹´ìŠ¤ì˜ ìš”ìƒˆ', max: 1, shared: false },
            { id: 'tower', name: 'ì†Œë©¸ì˜ íƒ‘', max: 3, shared: false },
            { id: 'tero', name: 'ì´ì„¸ê³„: í…Œë¡œì¹´ ê³µì„±ì „', max: 1, shared: false },
            { id: 'temple', name: 'ì´ì„¸ê³„: ì‹œê°„ì˜ ì‚¬ì›', max: 1, shared: false },
            { id: 'kounat', name: 'ì´ì„¸ê³„: ì½”ìš°ë‚˜íŠ¸ ëŒ€í­ë°œ', max: 1, shared: false },
            { id: 'corridor', name: 'ë¬´í•œíšŒë‘', max: 3, type: 'daily', shared: true } // ì¼ì¼/ê³„ì • ê³µìœ ë¡œ ì´ë™
        ],
        weekly: [
            { id: 'judge', name: 'ì‹¬íŒì˜ ë•…', max: 3, type: 'weekly', shared: false }, // 3íšŒ ìˆ˜ì •
            { id: 'abyss', name: 'ì‹¬ì—°ì˜ ê¸¸', max: 1, type: 'weekly', shared: false },
            // ê³µí—ˆ ë˜ì „ ìƒì„¸ ë°˜ì˜
            { id: 'void', name: 'ê³µí—ˆ ë˜ì „', max: 2, type: 'weekly', shared: false, sub: '(ì¹¨ê³µ:ì›” / ì ì‹:ìˆ˜ / ì•…ëª½:ê¸ˆ í™œì„±í™”)' }, 
            { id: 'w_furnace', name: 'ì§€ì˜¥ì˜ ìš©ê´‘ë¡œ', max: 3, type: 'weekly', shared: false },
            { id: 'w_sanctum', name: 'íŒŒë©¸ì˜ ì„±ì†Œ', max: 3, type: 'weekly', shared: false },
            { id: 'w_laby', name: 'í™˜ì˜ì˜ ë¯¸ê¶', max: 5, type: 'weekly', shared: false }
        ]
    };

    let characters = []; 
    let currentChrId = null; 
    let draggedElement = null; // DNDë¥¼ ìœ„í•œ ì „ì—­ ë³€ìˆ˜

    // === 2. ë°ì´í„° ì´ˆê¸°í™”/ë¶ˆëŸ¬ì˜¤ê¸° ===

    const generateInitialTasks = (type) => {
        const tasks = {};
        // ê³µìœ  ìˆ™ì œëŠ” ìºë¦­í„°ë³„ë¡œ ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ
        DUNGEON_DATA[type].filter(d => !d.shared).forEach(d => {
            tasks[d.id] = { completed: 0, max: d.max };
        });
        return tasks;
    };
    
    const getTaskMaxCount = (taskId) => {
        // ì¼ì¼ ëª©ë¡ì—ì„œ ì°¾ê¸°
        let item = DUNGEON_DATA.daily.find(d => d.id === taskId);
        // ì—†ìœ¼ë©´ ì£¼ê°„ ëª©ë¡ì—ì„œ ì°¾ê¸°
        if (!item) item = DUNGEON_DATA.weekly.find(d => d.id === taskId);
        
        return item ? item.max : 1;
    };

    const getAccountSharedTaskStatus = (id) => {
        const saved = localStorage.getItem(`shared_${id}`);
        return saved ? JSON.parse(saved) : { completed: 0, max: getTaskMaxCount(id) };
    };

    const setAccountSharedTaskStatus = (id, status) => {
        localStorage.setItem(`shared_${id}`, JSON.stringify(status));
    };

    function initializeData() {
        // 1. ìºë¦­í„° ìˆœì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        const savedOrder = localStorage.getItem('characterOrder');
        if (savedOrder) {
            // ì €ì¥ëœ ìˆœì„œì— ë§ì¶°ì„œ ê¸°ë³¸ ìºë¦­í„° ëª©ë¡ì„ ì¬ë°°ì¹˜
            const savedNames = JSON.parse(savedOrder);
            // ê¸°ë³¸ ëª©ë¡ì—ì„œ ëˆ„ë½ëœ ìºë¦­í„°ê°€ ìˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ í˜„ì¬ ìˆœì„œì— ì¶”ê°€
            const newNames = CHARACTER_NAMES.filter(name => !savedNames.includes(name));
            CHARACTER_NAMES = [...savedNames, ...newNames];
        }
        
        // 2. ìºë¦­í„° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°/ìƒì„±
        const savedData = localStorage.getItem('gc_characters');
        const lastReset = localStorage.getItem('lastResetTime');

        // ê¸°ì¡´ ìºë¦­í„° ID ëª©ë¡ ìƒì„±
        const existingIds = savedData ? JSON.parse(savedData).map(c => c.id) : [];
        let nextId = existingIds.length > 0 ? Math.max(...existingIds) + 1 : 1;
        
        // ê¸°ì¡´ ìºë¦­í„° ë§µ ìƒì„± (ì´ë¦„ ê¸°ì¤€)
        const charMap = new Map(savedData ? JSON.parse(savedData).map(c => [c.name, c]) : []);

        // ìˆœì„œ ë°°ì—´(CHARACTER_NAMES)ì— ë§ì¶° ìºë¦­í„° ë°ì´í„° ì •ë ¬/ì—…ë°ì´íŠ¸
        characters = CHARACTER_NAMES.map(name => {
            let char = charMap.get(name);
            
            if (!char) {
                // ìƒˆë¡œìš´ ìºë¦­í„° ìƒì„± (ì´ë¦„ì€ ìˆì§€ë§Œ ë°ì´í„°ëŠ” ì—†ëŠ” ê²½ìš°)
                char = {
                    id: nextId++,
                    name: name,
                    dailyTasks: generateInitialTasks('daily'),
                    weeklyTasks: generateInitialTasks('weekly')
                };
            }
            
            // ë°ì´í„° êµ¬ì¡° ê°±ì‹  (max count ë°˜ì˜ ë° ìƒˆ ë˜ì „/êµ¬ì¡° ì¶”ê°€)
            const updatedChar = { ...char };
            
            // ì¼ì¼ ìˆ™ì œ ê°±ì‹ /ì´ˆê¸°í™” (ê³µìœ  ìˆ™ì œ ì œì™¸)
            updatedChar.dailyTasks = updatedChar.dailyTasks || {};
            DUNGEON_DATA.daily.filter(d => !d.shared).forEach(d => {
                const savedTask = updatedChar.dailyTasks[d.id];
                updatedChar.dailyTasks[d.id] = {
                    completed: savedTask ? (savedTask.completed || 0) : 0,
                    max: d.max
                };
            });
            
            // ì£¼ê°„ ìˆ™ì œ ê°±ì‹ /ì´ˆê¸°í™” (ê³µìœ  ìˆ™ì œ ì œì™¸)
            updatedChar.weeklyTasks = updatedChar.weeklyTasks || {};
            DUNGEON_DATA.weekly.filter(d => !d.shared).forEach(d => {
                const savedTask = updatedChar.weeklyTasks[d.id];
                updatedChar.weeklyTasks[d.id] = {
                    completed: savedTask ? (savedTask.completed || 0) : 0,
                    max: d.max
                };
            });
            
            return updatedChar;
        });
        
        localStorage.setItem('gc_characters', JSON.stringify(characters));
        currentChrId = localStorage.getItem('currentChrId') || (characters.length > 0 ? characters[0].id : null);
        
        checkAndApplyReset(characters, lastReset);
    }

    // === 3. ì´ˆê¸°í™” ë¡œì§ ===
    function checkAndApplyReset(currentChars, lastResetTime) {
        const now = new Date();
        const kstNow = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Seoul"}));
        let isDailyReset = false;
        let isWeeklyReset = false;

        let dailyResetPoint = new Date(kstNow);
        if (kstNow.getHours() < 15) { dailyResetPoint.setDate(dailyResetPoint.getDate() - 1); }
        dailyResetPoint.setHours(15, 0, 0, 0);

        let weeklyResetPoint = new Date(kstNow);
        const day = weeklyResetPoint.getDay(); 
        const WEDNESDAY = 3; 
        const diff = (day + 7 - WEDNESDAY) % 7; 
        weeklyResetPoint.setDate(weeklyResetPoint.getDate() - diff);
        weeklyResetPoint.setHours(15, 0, 0, 0);
        if (weeklyResetPoint > kstNow) weeklyResetPoint.setDate(weeklyResetPoint.getDate() - 7);

        const lastCheckTime = lastResetTime ? parseInt(lastResetTime) : 0;
        
        if (lastCheckTime < dailyResetPoint.getTime()) { isDailyReset = true; }
        if (lastCheckTime < weeklyResetPoint.getTime()) { isWeeklyReset = true; }

        if (isDailyReset || isWeeklyReset) {
            
            characters = currentChars.map(char => {
                let newChar = {...char};
                
                // 1. ìºë¦­í„°ë³„ ìˆ™ì œ ì´ˆê¸°í™”
                if (isDailyReset) {
                    DUNGEON_DATA.daily.filter(d => !d.shared).forEach(d => {
                        newChar.dailyTasks[d.id].completed = 0;
                    });
                }
                
                if (isWeeklyReset) {
                    DUNGEON_DATA.weekly.filter(d => !d.shared).forEach(d => {
                        newChar.weeklyTasks[d.id].completed = 0;
                    });
                }
                return newChar;
            });
            
            // 2. ê³„ì • ê³µìœ  ìˆ™ì œ ì´ˆê¸°í™” (ë¬´í•œíšŒë‘)
            if (isDailyReset) {
                const infiniteCorridor = DUNGEON_DATA.daily.find(d => d.id === 'corridor');
                if (infiniteCorridor && infiniteCorridor.shared) {
                    setAccountSharedTaskStatus('corridor', { completed: 0, max: infiniteCorridor.max });
                }
            }
            
            localStorage.setItem('gc_characters', JSON.stringify(characters));
            localStorage.setItem('lastResetTime', now.getTime());
        }
    }

    // === 4. DND ë¡œì§ ===
    
    function handleDragStart(e) {
        draggedElement = e.target;
        e.dataTransfer.effectAllowed = 'move';
        e.target.classList.add('dragging');
    }

    function handleDragOver(e) {
        e.preventDefault(); 
        e.dataTransfer.dropEffect = 'move';
        const target = e.target.closest('.char-btn');
        if (target && target !== draggedElement) {
            // ë“œë¡­ë  ìœ„ì¹˜ ì‹œê°í™”
            const selector = document.getElementById('character-selector');
            const children = Array.from(selector.children);
            children.forEach(child => child.classList.remove('drag-over'));
            
            target.classList.add('drag-over');
        }
    }

    function handleDragLeave(e) {
        e.target.classList.remove('drag-over');
    }

    function handleDrop(e) {
        e.preventDefault();
        const target = e.target.closest('.char-btn');
        if (draggedElement && target && draggedElement !== target) {
            
            const selector = document.getElementById('character-selector');
            const children = Array.from(selector.children);
            
            const sourceIndex = children.indexOf(draggedElement);
            const targetIndex = children.indexOf(target);

            // ë°°ì—´ì—ì„œ ìˆœì„œ ë³€ê²½
            const [removed] = CHARACTER_NAMES.splice(sourceIndex, 1);
            CHARACTER_NAMES.splice(targetIndex > sourceIndex ? targetIndex : targetIndex, 0, removed);
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('characterOrder', JSON.stringify(CHARACTER_NAMES));
            
            // UI ì—…ë°ì´íŠ¸ ë° ë°ì´í„° ì¬ì´ˆê¸°í™” (ìˆœì„œ ì ìš©)
            render();
        }
        document.getElementById('character-selector').querySelectorAll('.char-btn').forEach(btn => btn.classList.remove('drag-over'));
    }

    function handleDragEnd(e) {
        e.target.classList.remove('dragging');
        draggedElement = null;
        document.getElementById('character-selector').querySelectorAll('.char-btn').forEach(btn => btn.classList.remove('drag-over'));
    }

    // === 5. ì•¡ì…˜ í•¸ë“¤ëŸ¬ (ë‹¨ì¼ í´ë¦­ ì™„ë£Œ ë¡œì§ ì ìš©) ===

    function selectCharacter(id) {
        currentChrId = id;
        localStorage.setItem('currentChrId', id);
        render();
    }

    function toggleTask(chrId, type, taskId, shared) {
        const item = DUNGEON_DATA[type].find(d => d.id === taskId);
        
        if (shared) {
            // ê³„ì • ê³µìœ  ìˆ™ì œ ì²˜ë¦¬ (0 <-> max)
            const status = getAccountSharedTaskStatus(taskId);
            const newCount = status.completed === 0 ? item.max : 0; 
            setAccountSharedTaskStatus(taskId, { completed: newCount, max: item.max });
        } else {
            // ìºë¦­í„°ë³„ ìˆ™ì œ ì²˜ë¦¬ (0 <-> max)
            const charIndex = characters.findIndex(c => c.id === chrId);
            if (charIndex === -1) return;
    
            const char = characters[charIndex];
            const currentCount = char[`${type}Tasks`][taskId].completed;
            
            const newCount = currentCount === 0 ? item.max : 0;
            
            char[`${type}Tasks`][taskId].completed = newCount;
            localStorage.setItem('gc_characters', JSON.stringify(characters));
        }

        render();
    }
    
    // === 6. UI/UX í…Œë§ˆ ë¡œì§ ===
    
    const getTheme = () => localStorage.getItem('theme') || 'dark';

    function setTheme(theme) {
        document.body.className = theme === 'dark' ? 'dark-mode' : 'light-mode';
        localStorage.setItem('theme', theme);
        updateThemeToggleText(theme);
    }
    
    function toggleTheme() {
        const currentTheme = getTheme();
        setTheme(currentTheme === 'dark' ? 'light' : 'dark');
    }

    function updateThemeToggleText(theme) {
        const button = document.getElementById('theme-toggle');
        button.innerText = theme === 'dark' ? 'â˜€ï¸ ë‚® ëª¨ë“œ' : 'ğŸŒ™ ë°¤ ëª¨ë“œ';
    }

    // === 7. í™”ë©´ ë Œë”ë§ ===

    function renderCharacterSelector() {
        const selector = document.getElementById('character-selector');
        selector.innerHTML = '';

        characters.forEach(char => {
            const button = document.createElement('button');
            button.className = `char-btn ${char.id == currentChrId ? 'active' : ''}`;
            button.innerText = char.name;
            button.onclick = () => selectCharacter(char.id);
            
            // DND ì†ì„± ì¶”ê°€
            button.setAttribute('draggable', true);
            button.addEventListener('dragstart', handleDragStart);
            button.addEventListener('dragover', handleDragOver);
            button.addEventListener('dragleave', handleDragLeave);
            button.addEventListener('drop', handleDrop);
            button.addEventListener('dragend', handleDragEnd);

            selector.appendChild(button);
        });
    }

    function renderTaskList() {
        const currentCharacter = characters.find(c => c.id == currentChrId);
        
        if (!currentCharacter) {
            document.getElementById('current-char-name').innerText = 'ìºë¦­í„°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.';
            document.getElementById('task-view-container').style.display = 'none';
            return;
        }
        
        document.getElementById('task-view-container').style.display = 'flex';
        document.getElementById('current-char-name').innerText = `í˜„ì¬ ì„ íƒ ìºë¦­í„°: [${currentCharacter.name}]`;

        const renderList = (type, listId) => {
            const container = document.getElementById(listId);
            container.innerHTML = '';
            
            const listToRender = DUNGEON_DATA[type];
            
            listToRender.forEach(item => {
                const isShared = item.shared || false;
                let taskStatus;
                
                // ê³µìœ  ìˆ™ì œëŠ” ìºë¦­í„° ID ëŒ€ì‹  'shared' ìƒíƒœ ì‚¬ìš©
                if (isShared) {
                    taskStatus = getAccountSharedTaskStatus(item.id);
                } else {
                    taskStatus = currentCharacter[`${type}Tasks`][item.id] || { completed: 0, max: item.max };
                }

                const isCompleted = taskStatus.completed >= taskStatus.max;
                
                const div = document.createElement('div');
                div.onclick = () => toggleTask(currentCharacter.id, type, item.id, isShared);
                div.className = `task-item ${isCompleted ? 'done' : ''}`;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = isCompleted;
                checkbox.onclick = (e) => {
                    e.stopPropagation(); 
                    toggleTask(currentCharacter.id, type, item.id, isShared);
                };

                const labelGroup = document.createElement('div');
                labelGroup.className = 'task-label-group';
                
                const label = document.createElement('span');
                label.className = 'task-label';
                label.innerText = item.name;
                labelGroup.appendChild(label);
                
                if (item.sub) { // ê³µí—ˆ ë˜ì „ ì„œë¸Œ ë¼ë²¨
                    const subLabel = document.createElement('span');
                    subLabel.style.fontSize = '0.8em';
                    subLabel.style.marginLeft = '10px';
                    subLabel.style.opacity = '0.8';
                    subLabel.style.fontWeight = 'normal';
                    subLabel.style.color = 'var(--text-color)';
                    subLabel.innerText = item.sub;
                    labelGroup.appendChild(subLabel);
                }

                if (isShared) { // ê³„ì • ê³µìœ  íƒœê·¸
                    const tag = document.createElement('span');
                    tag.className = 'account-shared-tag';
                    tag.innerText = item.type === 'daily' ? 'ê³„ì • ê³µìœ  (ì¼ì¼)' : 'ê³„ì • ê³µìœ  (ì£¼ê°„)';
                    labelGroup.appendChild(tag);
                }
                
                const countDisplay = document.createElement('span');
                countDisplay.className = `count-display ${isCompleted ? 'completed' : ''}`;
                countDisplay.innerText = `${taskStatus.completed}/${taskStatus.max}`;

                const leftContainer = document.createElement('div');
                leftContainer.style.display = 'flex';
                leftContainer.style.alignItems = 'center';
                leftContainer.appendChild(checkbox);
                leftContainer.appendChild(labelGroup);
                
                div.innerHTML = '';
                div.appendChild(leftContainer);
                div.appendChild(countDisplay);

                container.appendChild(div);
            });
        };

        renderList('daily', 'daily-list');
        renderList('weekly', 'weekly-list');
    }
    
    function render() {
        initializeData();
        renderCharacterSelector();
        renderTaskList();
    }

    // === 8. ì‹œì‘ ë° ì£¼ê¸°ì  ì²´í¬ ===
    
    setTheme(getTheme()); 
    render();
    
    // 1ë¶„ë§ˆë‹¤ ì´ˆê¸°í™” ì‹œê°„ì´ ì§€ë‚¬ëŠ”ì§€ ì²´í¬
    setInterval(render, 60000); 

</script>

</body>
</html>
